function orderLine(a,b){var c=this;c.pizzaSize=ko.observable(a),c.pizza=ko.observable(b)}function PizzaViewModel(){var a=this;a.currentPath=ko.observable(),a.showPizzaMenu=ko.observable(!1),a.initError=!1,a.userName=ko.observable(""),a.userAddress=ko.observable(""),a.userPhone=ko.observable(""),a.userNote=ko.observable(""),a.pizzas=pizzaDimension,a.currentOrderContext=ko.observable(),a.pizzaRouter=Sammy(function(){this.get("#/intro",function(){a.currentPath("intro"),a.showPizzaMenu(!1)}),this.get("#/start",function(){a.currentPath("start"),a.showPizzaMenu(!1)}),this.get("#/pizza",function(){a.currentPath("start"),a.showPizzaMenu(!0)}),this.get("#/potvrda",function(){a.currentPath("potvrda"),a.showPizzaMenu(!1)}),this.get("",function(){this.app.runRoute("get","#/intro")})}).run(),a.order=ko.observableArray([new orderLine("large",a.pizzas[0])]),a.addPizza=function(){this.order.push(new orderLine("large",a.pizzas[0]))},a.killPizza=function(b){a.order.remove(b)},a.showOrderLine=function(a){1===a.nodeType&&(console.log("Show element:\n"+a),$(a).hide().fadeIn())},a.hideOrderLine=function(a){1===a.nodeType&&(console.log("Hide element:\n"+a),$(a).fadeOut(function(){$(a).remove()}))},a.pizzaPrice=function(a){return a.pizza()[a.pizzaSize()]},a.pizzaSelected=function(b){a.currentOrderContext.pizza(b),a.pizzaRouter.setLocation("#/start")},a.menuPizza=function(b){a.currentOrderContext=b,a.pizzaRouter.setLocation("#/pizza")},a.subTotal=function(a){order=ko.toJS(a);for(var b=0,c=0;c<order.length;c++)b+=order[c].pizza[order[c].pizzaSize];return b},a.sizeTranslate=function(a){var b="Whaa?",c=a.pizzaSize();switch(c){case"small":b="Mala";break;case"large":b="Velika";break;case"jumbo":b="Jumbo"}return b},a.finalizeOrder=function(){var b={},c=ko.toJS(a.order),d=0,e={userName:ko.utils.unwrapObservable(a.userName),userAddress:ko.utils.unwrapObservable(a.userAddress),userPhone:ko.utils.unwrapObservable(a.userPhone),userNote:ko.utils.unwrapObservable(a.userNote),isProcessed:0};try{$.post("/order/create",e).done(function(a){if(a.id){d=a.id,console.log("All good.",a),console.log("Order ID: ",d);for(var e=c.length-1;e>=0;e--){b={order:d,pizza:c[e].pizza.name,pizzaSize:c[e].pizzaSize};try{$.post("/orderline/create",b).done(function(a){a.id?(console.log("All good.",a),window.location="/congrats"):(console.log("Post problems: ",a),$("#init_error_window").fadeIn("fast"))}).fail(function(){console.log("Post failure",a),$("#init_error_window").fadeIn("fast")})}catch(f){$("#init_error_window").fadeIn("fast"),console.log("Catched!",f)}}}else console.log("Post problems: ",a),$("#init_error_window").fadeIn("fast"),$("#error_window_content").appendTo("<pre>"+a+"</pre>")}).fail(function(){console.log("Post failure",ajaxResponse),$("#init_error_window").fadeIn("fast")})}catch(f){$("#init_error_window").fadeIn("fast"),console.log("Catched!"+f.toString()),console.log(f)}}}$(document).keyup(function(a){27==a.keyCode&&(console.log("ESC keypress detected"),showPizzaMenu=viewModel.showPizzaMenu(),console.log("showPizzaMenu = "+showPizzaMenu),1==showPizzaMenu&&window.history.go(-1))}),formatPrice=function(a){return a?a.toFixed(2).toString().replace(".",","):"0,00"},ko.bindingHandlers.fadeVisible={init:function(a,b){var c=b();$(a).toggle(ko.utils.unwrapObservable(c))},update:function(a,b){var c=b();ko.utils.unwrapObservable(c)?$(a).animate({display:"none"},200).fadeIn("fast"):$(a).fadeOut("fast")}};var hostName=window.location.host,socket=io.connect("http://"+hostName),viewModel,pizzaDimension={};$(document).ready(function(){$.getJSON("/pizza/findAll").done(function(a){pizzaDimension=a;try{viewModel=new PizzaViewModel,ko.applyBindings(viewModel)}catch(b){$("#init_error_window").fadeIn("fast")}}).fail(function(){$("#init_error_window").fadeIn("fast")})});